#!/bin/bash
# PostgreSQL backup script for Remember Me MCP
# Generated by Ansible

set -e

BACKUP_DIR="/var/backups/postgresql"
DB_NAME="{{ vault_postgres_db }}"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="${BACKUP_DIR}/${DB_NAME}_${DATE}.sql.gz"

# Create backup
pg_dump -d "${DB_NAME}" | gzip > "${BACKUP_FILE}"

# Keep only last 7 days of backups
find "${BACKUP_DIR}" -name "${DB_NAME}_*.sql.gz" -type f -mtime +7 -delete

echo "Backup completed: ${BACKUP_FILE}"